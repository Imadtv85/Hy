name: Live Streaming to Facebook via RTMPS

on:
  push:
    branches:
      - main  # يمكنك تخصيص الفرع حسب حاجتك
  workflow_dispatch:  # يسمح بتشغيل الـ Action يدويًا عبر واجهة GitHub

jobs:
  stream:
    runs-on: ubuntu-latest  # قم باستخدام أحدث إصدار من أوبونتو

    steps:
      # خطوة 1: تحقق من الكود
      - name: Checkout repository
        uses: actions/checkout@v2

      # خطوة 2: تثبيت FFmpeg
      - name: Install FFmpeg
        run: |
          sudo apt update
          sudo apt install -y ffmpeg

      # خطوة 3: بدء البث باستخدام m3u8 و stream key عبر RTMPS
      - name: Start streaming to Facebook with m3u8 and stream key
        run: |
          # تعيين مسار ملف m3u8 و stream key
          M3U8_URL="http://mo3ad.xyz/GpfGbMNfzW/XJFgkQnpXd/14"  # الرابط الذي قدمته
          STREAM_KEY="FB-568378652600328-0-AbyCAGU7ScZjZLHG"  # هذا هو الـ Stream Key الخاص بك
          STREAM_URL="rtmps://live-api-s.facebook.com:443/rtmp/$STREAM_KEY"  # رابط RTMPS لفيسبوك

          # استخدم FFmpeg للبث إلى فيسبوك عبر RTMPS
          ffmpeg -re -i $M3U8_URL -c:v libx264 -preset veryfast -max_muxing_queue_size 1024 -f flv $STREAM_URL

      # خطوة 4: تحقق من بدء البث (اختياري)
      - name: Verify stream started
        run: |
          echo "Streaming to Facebook with stream key $STREAM_KEY"
